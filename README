== TimedMediaHandler ==

This extension provides a media handler for the Ogg, WebM, mp4 container format.
When enabled, a player will be automatically embedded in the file description
page, or any wiki page while still using the same syntax as for images.

* Broad support for input file formats
* Transcoder to make video at web resolutions when embedding clips in a page
* include support for timed Text per the w3c "track" recommendation
* use embedPlayer mwEmbed javascript module for playback

To install this extension, add the following to the end of your
LocalSettings.php:

	// You need mwEmbedSupport ( if not already added )
	require( "$IP/extensions/MwEmbedSupport/MwEmbedSupport.php" );

	// TimedMediaHandler
    require( "$IP/extensions/TimedMediaHandler/TimedMediaHandler.php" );


== Running Transcodes ==

Transcoding a video to another resolution or format takes a good amount which
prevents that processing to be handled as a web service. Instead, the extension
implements an asynchronous job, named webVideoTranscode, which you must be
running regularly as your web server user.

The job can be run using the MediaWiki maintenance/runJobs.php utility (do not
forget to su as a webserver user):

  php runJobs.php --type webVideoTranscode --maxjobs 1

As a convenience, the extension provides a wrapper script which will check for
new jobs every 5 minutes. The script is WebVideoJobRunner.php in maintenance
folder (do not forget to run it as the webserver user)::

  WebVideoJobRunner.php


== Kaltura HTML5 player library ==

TimedMediaHandler uses the Kaltura HTML5 player library for video playback, it
relies on the <video> element as well as JavaScript.

For more information about the player library visit:
  http://www.html5video.org/kaltura-player/docs


== FFmpeg ==

We use FFmpeg for two purposes:
 - creating still images of videos (aka thumbnails)
 - transcoding webm videos
 - transcoding h264 videos

For best experience use the latest release of ffmpeg. At a minimum ffmpeg 0.6.1
was the first version to include WebM support.

If you are operating system distribution does not include the required ffmpeg software, you can download static builds for multiple platforms at:
  http://firefogg.org/nightly/

Download source: http://ffmpeg.org/download.html

Static Binary /latest version/ distribution for major OS
( with webm encoder and borad decode support )
http://firefogg.org/nightly/

Suggested configure line for minimal functionality:

./configure --disable-demuxers --disable-muxers
  --disable-decoders --disable-encoders \
  --disable-ffserver --disable-ffplay \
  --enable-encoder=mjpeg --enable-muxer=mjpeg \
  --enable-decoder=theora --enable-demuxer=ogg --disable-network \
  --disable-devices --disable-parsers --enable-parser=vp3 \
  --build-suffix=-still

Suggested configure line for webm encoding and decoding of many formats:

  --enable-gpl --enable-version3 --enable-postproc --enable-libvorbis \
  --enable-pthreads --disable-shared --disable-ffserver --disable-ffprobe \
  --enable-postproc --enable-libopencore-amrnb --enable-libopencore-amrwb \
  --enable-bzlib --enable-libtheora --enable-libspeex --enable-libvpx \
  --disable-encoders --disable-decoder=vp8 --disable-muxers \
  --enable-encoder='bmp,dvvideo,ffv1,ffvhuff,flac,gif,huffyuv,libdirac,\
      libschroedinger,libtheora,libvorbis,libvpx,mjpeg,pbm,pcm_f32be,\
      pcm_f32le,pcm_f64be,pcm_f64le,pcm_s16be,pcm_s16le,pcm_s24be,\
      pcm_s24le,pcm_s32be,pcm_s32le,pcm_s8,pcm_u16be,pcm_u16le,pcm_u24be,\
      pcm_u24le,pcm_u32be,pcm_u32le,pcm_u8,pgm,pgmyuv,png,ppm,rawvideo,tiff,\
      vorbis,zlib' \
  --enable-muxer='aiff,crc,dv,gif,image2,image2pipe,matroska,matroska_audio,\
      md5,mjpeg,null,ogg,pcm_f32be,pcm_f32le,pcm_f64be,pcm_f64le,pcm_s16le,\
      pcm_s24be,pcm_s24le,pcm_s32be,pcm_s32le,pcm_s8,pcm_u16be,pcm_u16le,\
      pcm_u24be,pcm_u24le,pcm_u32be,pcm_u32le,pcm_u8,rawvideo,wav,webm,\
      yuv4mpegpipe'

Guide for building ffmpeg with h.264 for ubuntu: 
https://ffmpeg.org/trac/ffmpeg/wiki/UbuntuCompilationGuide

Note: there must be a simpler way to add all those encoders and muxers.

Some old versions of FFmpeg had a bug which made it extremely slow to seek in
large theora videos in order to generate a thumbnail.  If you are using an old
version of FFmpeg and find that performance is extremely poor (tens of seconds)
to generate thumbnails of theora videos that are several minutes or more in
length, try applying our ffmpeg-bugfix.diff.
About the bug: https://roundup.mplayerhq.hu/roundup/ffmpeg/issue159

In MediaWiki configuration, after the require line in LocalSettings.php, you
will have to specify the FFmpeg binary location with:

    $wgFFmpegLocation = '/path/to/ffmpeg';

Default being `/usr/bin/avconv`.


== ffmpeg2theora ==

We use ffmpeg2theora for extract metadata from videos, you will need a copy on
your server. For best experience, use the latest release of ffmpeg2theora. At a
minimum you need to use ffmpeg2thoera 0.27.

You can download static ffmpeg2theora builds for multiple platforms at:
http://firefogg.org/nightly/

Set the ffmpeg2theora binary location with:

    $wgFFmpeg2theoraLocation = '/path/to/ffmpeg2theora';

Default being `/usr/bin/ffmpeg2theora`.


== Cortado ==

Wikimedia uses Cortado Java applet from Xiph.org.

A .jar file compiled from this tree is provided in the OggHandler directory for
your convenience.

For information about Cortado see:

    http://theora.org/cortado/

See LICENSE.cortado, LICENSE.jheora and LICENSE.smoke for license information.


== PEAR File_Ogg ==

Tim Starling, a Wikimedia developer, forked the PEAR File_Ogg package and
improved it significantly to support this extension. He has taken over
maintainership of File_ogg  merged my changes into the latest release.

Thus, the extension will now work with either the bundled File_Ogg class, or a
File_Ogg package from PEAR since version 0.3.0 or greater.

The PEAR bundle is licensed under the LGPL, you can get informations about
this package on the pear webpage:

  http://pear.php.net/package/File_Ogg

As per the usual convention, the PEAR base directory (the one with PEAR.php in
it) must be in your include_path. Note you do not need to install PEAR, its
included with the Timed Media Handler.


== getID3 ==

getID3 is used for metadata of WebM files.

getID3() by James Heinrich <info@getid3.org>
available at http://getid3.sourceforge.net
or http://www.getid3.org/

getID3 code is released under the GNU GPL:
http://www.gnu.org/copyleft/gpl.html
